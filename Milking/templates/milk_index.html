<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/mdb-ui-kit@3.5.0/css/mdb.min.css" rel="stylesheet" />
    <title>ğŸ„ğŸ‘‰ğŸ¥›</title>
</head>

<body onLoad="search_name();update_num();">

    <nav class="navbar navbar-dark sticky-top bg-success">
        <div class="container-fluid">
            <!-- <a class="navbar-brand">ğŸ„ğŸ‘‰ğŸ¥›</a> -->
            <small id="scan-num" class="text-white" onclick="get_num();">æ‰«æï¼š000000</small>
            <form class="d-flex input-group w-auto">
                <input id="search-input" type="search" class="form-control rounded" placeholder="Search"
                    aria-label="Search" aria-describedby="search-button" />
                <input type="text" style="display:none;" /> <!-- é¿å…æ‰‹æœºç«¯æœç´¢æ—¶é¡µé¢è‡ªåŠ¨åˆ·æ–°-->
                <span class="input-group-text border-0 text-white" id="search-addon">
                    <i class="fas fa-search" id="search-button" onclick="search_name();""></i>
                </span>
                <!-- <button id=" search-button" type="button" class="btn btn-success" onclick="search_name();">
                        <i class="fas fa-search"></i>
                        </button> -->
            </form>
        </div>
    </nav>


    <section class="p-1 mb-1">
        <div class="card text-white bg-dark">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr class="table-dark">
                                <th scope="col">#</th>
                                <th scope="col">æ–‡ä»¶</th>
                                <th scope="col">å¤§å°</th>
                                <th scope="col">è¿‡æœŸæ—¶é—´</th>
                            </tr>
                        </thead>
                        <tbody id="result-table-tbody">
                            <!-- <tr tabindex="0" role="button" data-mdb-toggle="popover" data-mdb-trigger="focus" title="æ›´å¤šä¿¡æ¯"
                                data-mdb-content="åŠ å…¥æ—¶é—´ï¼š2021-03-03 30:08 è¿‡æœŸæ—¶é—´ï¼š2020-02-03 30:09:12">
                                <th scope="row"><a href="baidu.com">1</a></th>
                                <td>Mark</td>
                                <td>Otto</td>
                            </tr>
                            <tr>
                                <th scope="row">2</th>
                                <td>Jacob super super super long text test</td>
                                <td>Thornton</td>
                            </tr>
                            <tr>
                                <th scope="row">3</th>
                                <td colspan="2">Larry the Bird</td>
                            </tr> -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </section>


    <div class="card-footer fixed-bottom bg-dark text-white">
        <small id="page" class="text-muted">Last updated 3 mins ago</small>
        <div class="btn-group btn-group-sm" role="group" aria-label="Basic example" style="float: right;">
            <button id="first-page" type="button" class="btn btn-success"
                onclick="search_name(change_page = 0);">é¦–é¡µ</button>
            <button id="last-page" type="button" class="btn btn-success"
                onclick="search_name(change_page = -1);">ä¸Šä¸€é¡µ</button>
            <button id="next-page" type="button" class="btn btn-success"
                onclick="search_name(change_page = 1)">ä¸‹ä¸€é¡µ</button>
        </div>
    </div>



    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mdb-ui-kit@3.5.0/js/mdb.min.js"></script>


    <script type="text/javascript">
        show_num = 0
        scan_num = -100
        function update_num() {
            if (show_num - scan_num < 100) {
                show_num += randomNum(4,6);
                document.getElementById("scan-num").innerHTML = "æ‰«æï¼š" + show_num;
            }
            else {
                get_num();
            }
            //every five seconds to repeat self
            setTimeout("update_num()", 1000);
        }

        function get_num() {
            var req = new XMLHttpRequest();

            req.onreadystatechange = function () {
                if (req.readyState == 4 && req.status == 200) {
                    var str = req.responseText;//è·å–åˆ°jsonå­—ç¬¦ä¸²ï¼Œè¿˜éœ€è§£æ
                    var json = JSON.parse(str);//è½¬ä¸ºjson
                    document.getElementById("scan-num").innerHTML = "æ‰«æï¼š" + json["scan_num"];
                    scan_num = json["scan_num"];
                    show_num = json["scan_num"]
                }
            }
            req.open('POST', '/milk', true);
            req.setRequestHeader('content-type', 'application/x-www-form-urlencoded;charset=UTF-8');
            req.send("get_num=1");
        }

        //ç”Ÿæˆä»minNumåˆ°maxNumçš„éšæœºæ•°
        function randomNum(minNum, maxNum) {
            switch (arguments.length) {
                case 1:
                    return parseInt(Math.random() * minNum + 1, 10);
                    break;
                case 2:
                    return parseInt(Math.random() * (maxNum - minNum + 1) + minNum, 10);
                    break;
                default:
                    return 0;
                    break;
            }
        }
    </script>


    <script type="text/javascript">
        var input = document.getElementById("search-input");
        input.addEventListener("keyup", function (event) {
            event.preventDefault();
            if (event.keyCode === 13) {
                search_name();
            }
        });
    </script>

    <script type="text/javascript">
        var page = 1;
        function search_name(change_page = 0) {
            var new_page = page;
            const searchInput = document.getElementById('search-input');
            const inputValue = searchInput.value;
            var req = new XMLHttpRequest();
            var result = document.getElementById('result');
            switch (change_page) {
                case 0:
                    page = 1;
                    new_page = 1;
                    break;
                default:
                    new_page = new_page + change_page
                    if (new_page < 1) {
                        new_page = 1
                    }
                    break;
            }


            req.onreadystatechange = function () {
                if (req.readyState == 4 && req.status == 200) {
                    var str = req.responseText;//è·å–åˆ°jsonå­—ç¬¦ä¸²ï¼Œè¿˜éœ€è§£æ
                    var json = JSON.parse(str);//è½¬ä¸ºjson
                    const result_table = document.getElementById('result-table-tbody');
                    var div_content = "";
                    var item = "";
                    if (json["length"] == 0) {
                        alert("æ‰¾ä¸åˆ°ç›¸å…³æ–‡ä»¶")
                    }
                    else {
                        for (var i = 0; i < json["length"]; i++) {
                            item = '<tr class="table-dark">';
                            item += '<th scope="row">'
                                + '<a class="link-success" target="_blank" href="https://cowtransfer.com/s/'
                                + json["result"][i]['uniqueUrl']
                                + '">'
                                + json["result"][i]['tempCode']
                                + '</a></th>';
                            item += '<td>';
                            // item += '<div class="btn-group shadow-0">'
                            //     + '<button type="button" class="btn btn-light dropdown-toggle" data-mdb-toggle="dropdown" aria-expanded="false">'
                            //     + json["result"][i]['fileName']
                            //     + '</button>'
                            //     + '<ul class="dropdown-menu dropdown-menu-dark">'
                            //     + '<li><a class="dropdown-item" href="#">Action</a></li>'
                            //     + '<li><a class="dropdown-item active" href="#">Another action</a></li>'
                            //     + '<li><a class="dropdown-item" href="#">Something else here</a></li>'
                            //     + '</ul>'
                            //     + '</div>'
                            item += json["result"][i]['fileName'];
                            item += '</td>';
                            item += '<td>' + json["result"][i]['totalSizeByte'] + '</td>';
                            item += '<td>' + json["result"][i]["expireAt"] + '</td>';
                            item += '</tr>';

                            div_content += item;
                        }
                        //div_content += '<div class="card mb-3 scrolltable text-white bg-primary" style="max-width: 80rem;"><div class="card-header">å¹¿å‘Šä½</div><div class="card-body"><h5 class="card-title">å‡ºå”®å®¿èˆè·¯ç”±å™¨</h5><p class="card-text">å‹å·ï¼šç½‘ä»¶ WNDR4300<br>å”®ä»·ï¼šï¿¥50+10ï¼ˆå®‰è£…è´¹ï¼‰<br>æœ‰æ„è€…è”ç³»ğŸ“15155425372</p></div></div>'
                        result_table.innerHTML = div_content;
                        page = new_page;
                    }
                    document.getElementById("page").innerHTML = "ç¬¬" + page + "é¡µ"
                }
            }
            req.open('POST', '/milk', true);
            req.setRequestHeader('content-type', 'application/x-www-form-urlencoded;charset=UTF-8');
            req.send("input=" + inputValue + "&" + "page=" + new_page);
        }
    </script>




</body>

</html>